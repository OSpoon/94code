---
date: 2023-04-04
title: å¸¦ä½ å¿«é€Ÿèµ°è¿›Chromeæ‰©å±•å¼€å‘çš„å¤§é—¨
tags:
- Chrome
- expansion 
description: Chrome æ‰©å±•ç¨‹åºé€šè¿‡å¯ä»¥å‘ Chrome æµè§ˆå™¨æ·»åŠ ç‰¹æ€§å’ŒåŠŸèƒ½æ¥å¢å¼ºæµè§ˆä½“éªŒï¼Œå¯ä»¥æ„å»ºä¸€äº›å¼ºå¤§çš„ç”Ÿäº§åŠ›å·¥å…·ï¼Œä¹Ÿå¯ä»¥ä¸°å¯Œç½‘é¡µçš„å†…å®¹ï¼Œè¿˜å¯ä»¥åšä¸€äº›ä¿¡æ¯çš„èšåˆç­‰ç­‰ã€‚æœ¬ç¯‡æ–‡ç« å°†å¸¦ä½ é€šè¿‡ä¸‰ä¸ªç®€å•çš„æ¡ˆä¾‹å¸¦ä½ å¿«é€Ÿèµ°è¿›Chromeæ‰©å±•å¼€å‘çš„å¤§é—¨ã€‚
---

# å¸¦ä½ å¿«é€Ÿèµ°è¿›Chromeæ‰©å±•å¼€å‘çš„å¤§é—¨

>ğŸ„Hi~ å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°é‘«åŒå­¦ï¼Œèµ„æ·± IT ä»ä¸šè€…ï¼ŒInfoQ çš„ç­¾çº¦ä½œè€…ï¼Œæ“…é•¿å‰ç«¯å¼€å‘å¹¶åœ¨è¿™ä¸€é¢†åŸŸæœ‰å¤šå¹´çš„ç»éªŒï¼Œè‡´åŠ›äºåˆ†äº«æˆ‘åœ¨æŠ€æœ¯æ–¹é¢çš„è§è§£å’Œå¿ƒå¾—

## è¿›å…¥æ­£é¢˜

Chrome æ‰©å±•ç¨‹åºå¯ä»¥é€šè¿‡å‘ Chrome æµè§ˆå™¨æ·»åŠ ç‰¹æ€§å’ŒåŠŸèƒ½æ¥å¢å¼ºæµè§ˆä½“éªŒï¼Œå¯ä»¥æ„å»ºä¸€äº›å¼ºå¤§çš„ç”Ÿäº§åŠ›å·¥å…·ï¼Œä¹Ÿå¯ä»¥ä¸°å¯Œç½‘é¡µçš„å†…å®¹ï¼Œè¿˜å¯ä»¥åšä¸€äº›ä¿¡æ¯çš„èšåˆç­‰ç­‰ã€‚æœ¬ç¯‡æ–‡ç« å°†å¸¦ä½ é€šè¿‡ä¸‰ä¸ªç®€å•çš„æ¡ˆä¾‹å¸¦ä½ å¿«é€Ÿèµ°è¿›Chromeæ‰©å±•å¼€å‘çš„å¤§é—¨ã€‚

## æ€ç»´è„‘å›¾

https://www.processon.com/view/link/642b9f2edd847f4d0fab623c

## Chromeæ‰©å±•å¼€å‘ä»‹ç»

### æŠ€èƒ½è¦æ±‚ï¼Ÿ

Chromeæ‰©å±•å¼€å‘æŠ€èƒ½è¦æ±‚åŒåˆ›å»ºWebåº”ç”¨ç¨‹åºç›¸åŒçš„WebæŠ€æœ¯ç¼–å†™ï¼Œä¹Ÿå°±æ˜¯ä½œä¸ºå‰ç«¯ç¨‹åºå‘˜æœ€ä¸ºç†Ÿæ‚‰çš„å‰ç«¯å¼€å‘ä¸‰ä»¶å¥—ï¼ŒHTMLã€CSS å’Œ JavaScriptã€‚

### Chromeæ‰©å±•APIï¼Ÿ

Chromeæ‰©å±•å¯ä»¥ä½¿ç”¨æµè§ˆå™¨æä¾›çš„æ‰€æœ‰JavaScriptAPIã€‚ä½¿ç”¨æ‰©å±•ç¨‹åºæ¯”Webåº”ç”¨ç¨‹åºæ›´å¼ºå¤§çš„æ˜¯å®ƒä»¬å¯¹ChromeAPIçš„è®¿é—®ã€‚

1. å¯ä»¥è·å¾—æ›´æ”¹ç½‘ç«™çš„åŠŸèƒ½å’Œè¡Œä¸ºã€‚
2. å…è®¸ç”¨æˆ·è·¨ç½‘ç«™æ”¶é›†å’Œç»„ç»‡ä¿¡æ¯ã€‚
3. å‘ Chrome DevTools æ·»åŠ åŠŸèƒ½ã€‚

### Chromeæ‰©å±•æ–‡ä»¶ï¼Ÿ

| åºå· | ç±»å‹ | æè¿° |
|--|--|--|
| 1 | manifest | æ‰©å±•ç¨‹åºçš„æ¸…å•æ˜¯å”¯ä¸€å¿…é¡»å…·æœ‰ç‰¹å®šæ–‡ä»¶åçš„å¿…éœ€æ–‡ä»¶ï¼š manifest.json ã€‚ å®ƒè¿˜å¿…é¡»ä½äºæ‰©å±•ç¨‹åºçš„æ ¹ç›®å½•ä¸­ã€‚æ¸…å•è®°å½•é‡è¦çš„å…ƒæ•°æ®ï¼Œå®šä¹‰èµ„æºï¼Œå£°æ˜æƒé™ï¼Œå¹¶æ ‡è¯†å“ªäº›æ–‡ä»¶åœ¨åå°å’Œé¡µé¢ä¸Šè¿è¡Œ|
| 2 | content scripts | å†…å®¹è„šæœ¬åœ¨ç½‘é¡µä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œ Javascriptã€‚ä»–ä»¬è¿˜å¯ä»¥è¯»å–å’Œä¿®æ”¹ä»–ä»¬æ³¨å…¥çš„é¡µé¢çš„ DOMã€‚ å†…å®¹è„šæœ¬åªèƒ½ä½¿ç”¨ Chrome API çš„ä¸€ä¸ªå­é›†ï¼Œä½†å¯ä»¥é€šè¿‡ä¸æ‰©å±•æœåŠ¡å·¥ä½œè€…äº¤æ¢æ¶ˆæ¯æ¥é—´æ¥è®¿é—®å…¶ä½™éƒ¨åˆ†|
| 3 | service worker | æ‰©å±•æœåŠ¡å·¥ä½œè€…å¤„ç†å’Œç›‘å¬æµè§ˆå™¨äº‹ä»¶ã€‚æœ‰å¤šç§ç±»å‹çš„äº‹ä»¶ï¼Œä¾‹å¦‚å¯¼èˆªåˆ°æ–°é¡µé¢ã€åˆ é™¤ä¹¦ç­¾æˆ–å…³é—­é€‰é¡¹å¡ã€‚å®ƒå¯ä»¥ä½¿ç”¨æ‰€æœ‰çš„Chrome APIï¼Œä½†ä¸èƒ½ç›´æ¥ä¸ç½‘é¡µå†…å®¹äº¤äº’ï¼›è¿™å°±æ˜¯å†…å®¹è„šæœ¬çš„å·¥ä½œ |
| 4 | popup/page | æ‰©å±•å¯ä»¥åŒ…å«å„ç§ HTML æ–‡ä»¶ï¼Œä¾‹å¦‚å¼¹å‡ºçª—å£ã€é€‰é¡¹é¡µé¢å’Œå…¶ä»– HTML é¡µé¢ã€‚æ‰€æœ‰è¿™äº›é¡µé¢éƒ½å¯ä»¥è®¿é—® Chrome API |

## å®ç°é˜…è¯»æ—¶é•¿æç¤º

é€šè¿‡å¼€å‘chrome expansionå®ç°åœ¨æ˜é‡‘æ–‡ç« é¡µé¢æç¤ºè¯»è€…å®Œæˆé˜…è¯»æ‰€éœ€è¦çš„å¤§æ¦‚æ—¶é—´ã€‚

### æ¡ˆä¾‹å…³é”®è¯

1. å†…å®¹è„šæœ¬
2. åŒ¹é…æ¨¡å¼

### æœŸæœ›æ•ˆæœ

* æ’ä»¶ç”Ÿæ•ˆå‰ï¼š

![](https://temp-files-20221205.oss-cn-hangzhou.aliyuncs.com/picgo/202304041503768.png)

* æ’ä»¶ç”Ÿæ•ˆåï¼š

![](https://temp-files-20221205.oss-cn-hangzhou.aliyuncs.com/picgo/202304041504314.png)

### é…ç½®æ¸…å•æ–‡ä»¶

å¯¹`manifest_version`ã€`name`ã€`description`ã€`version`å’Œ`icons`è¿™å‡ é¡¹è¿›è¡Œé…ç½®ã€‚

```json
{
  "manifest_version": 3,
  "name": "æ˜é‡‘æ’ä»¶",
  "description": "æ’ä»¶å¼€å‘æ¡ˆä¾‹",
  "version": "0.0.1",
  "icons": {
    "16": "./assets/icon-16.png",
    "32": "./assets/icon-32.png",
    "48": "./assets/icon-48.png",
    "128": "./assets/icon-128.png"
  }
}
```

PSï¼šé…åˆVSCodeæ’ä»¶ã€ŠChrome Extension Manifest JSON Schemaã€‹ä½¿ç”¨

### å°†å†…å®¹è„šæœ¬æ³¨å…¥é¡µé¢

1. å…ˆé…ç½®ï¼ˆæŒ‡å‘å†…å®¹è„šæœ¬æ–‡ä»¶ã€é…ç½®ç”Ÿæ•ˆèŒƒå›´ï¼ˆåŒ¹é…æ¨¡å¼ï¼‰ï¼‰ï¼š

```json
{
  "content_scripts": [
    {
      "js": ["./contents/juejin.js"],
      "matches": ["https://juejin.cn/post/*"]
    }
  ]
}
```

2. åç¼–å†™ï¼ˆè®¡ç®—é˜…è¯»æ—¶é•¿ã€æ³¨å…¥å…ƒç´ ï¼‰ï¼š

```JavaScript
/**
 * è®¡ç®—è¾“å…¥æ–‡æœ¬æ‰€éœ€è¦çš„é˜…è¯»æ—¶é•¿
 * @param {*} content 
 */
 function getReadTime(content) {
    // ç»Ÿè®¡æ–‡æœ¬ä¸­çš„å­—ç¬¦æ•°
    const totalWords = content.trim().split(/\s+/g).length;
    // è®¡ç®—æ¯åˆ†é’Ÿé˜…è¯»çš„å­—æ•°
    const wordsPerMinute = 200;
    // è®¡ç®—é¡µé¢çš„é˜…è¯»æ—¶é—´ï¼ˆå•ä½ä¸ºåˆ†é’Ÿï¼‰
    const readingTime = Math.ceil(totalWords / wordsPerMinute);
    return readingTime;
}

const main = document.querySelector("main");

if (main) {
    // å‘h1æ ‡é¢˜åé¢æ’å…¥ä¸€ä¸ªh3å°æ ‡é¢˜ï¼Œç”¨æ¥æ˜¾ç¤ºé˜…è¯»å®Œæˆéœ€è¦çš„æ—¶é—´
    const heading = main.querySelector("h1");
    const badge = document.createElement("h3");
    const readingTime = getReadTime(main.textContent);
    badge.textContent = `â±ï¸é˜…è¯»å®Œéœ€ï¼šçº¦ ${readingTime} åˆ†é’Ÿ`;
    heading.insertAdjacentElement("afterend", badge);
}
```

### åŠ è½½æ’ä»¶å¹¶æµ‹è¯•

1. æ‰“å¼€Chromeæ‰©å±•ç¨‹åºï¼ˆchrome://extensions/ï¼‰
2. æ‰“å¼€å¼€å‘è€…æ¨¡å¼
3. åŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åºï¼ˆåŒ…å«æ¸…å•æ–‡ä»¶çš„æ–‡ä»¶å¤¹ï¼‰

PSï¼šæ’ä»¶å¼€å‘è¿‡ç¨‹ä¸­ä¼šå¤šæ¬¡ä¿®æ”¹ï¼Œåœ¨ä¿®æ”¹åéœ€è¦åœ¨æµè§ˆå™¨çš„æ‰©å±•ç¨‹åºä¸­é‡æ–°åˆ·æ–°åç”Ÿæ•ˆ


## å®ç°ä¸“æ³¨é˜…è¯»æ¨¡å¼

é€šè¿‡å¼€å‘chrome expansionå®ç°å•å‡»æ‰©å±•ICONè¿›å…¥å’Œé€€å‡ºæ˜é‡‘æ–‡ç« ä¸“æ³¨é˜…è¯»æ¨¡å¼ã€‚ï¼ˆä¼šå¯¹å¤šä½™å†…å®¹è¿›è¡Œç²¾ç®€ï¼‰

### æ¡ˆä¾‹å…³é”®è¯

1. äº‹ä»¶åè°ƒå™¨
2. æƒé™ï¼šactiveTab
3. APIï¼šScripting API
4. å¿«æ·é”®

### æœŸæœ›æ•ˆæœ

* æ’ä»¶å¼€å¯å‰

![](https://temp-files-20221205.oss-cn-hangzhou.aliyuncs.com/picgo/202304041511484.png)

* æ’ä»¶å¼€å¯å

![](https://temp-files-20221205.oss-cn-hangzhou.aliyuncs.com/picgo/202304041511622.png)

### é…ç½®æ¸…å•æ–‡ä»¶

æ²¿ç”¨ä¸Šä¸€ä¸ªæ¡ˆä¾‹

### æ³¨å…¥æœåŠ¡å·¥ä½œè€…

1. å…ˆé…ç½®ï¼ˆæŒ‡å‘æœåŠ¡å·¥ä½œè€…æ–‡ä»¶ï¼‰

```json
{
  "background": {
    "service_worker": "background.js"
  }
}
```

2. åç¼–å†™

* ç›‘å¬onInstalledäº‹ä»¶ï¼Œæ›´æ–°æ’ä»¶å¾½ç« æ–‡æ¡ˆ
* ç›‘å¬onClickedäº‹ä»¶ï¼Œåœ¨æŒ‡å®šé€‰é¡¹å¡ä¸‹æ“ä½œæ—¶å˜æ›´æ’ä»¶çŠ¶æ€
* æ ¹æ®æ’ä»¶çŠ¶æ€å˜åŒ–åŠ¨æ€æ’å…¥å’Œåˆ é™¤ä¸“æ³¨æ¨¡å¼æ–‡ä»¶

```JavaScript
const webstore = 'https://juejin.cn/'

// ç›‘å¬onInstalledäº‹ä»¶ï¼Œåˆå§‹æ’ä»¶çŠ¶æ€
chrome.runtime.onInstalled.addListener(() => {
    chrome.action.setBadgeText({
        text: "OFF",
    });
});

// ç›‘å¬onClickedäº‹ä»¶ï¼Œåœ¨æŒ‡å®šé€‰é¡¹å¡ä¸‹æ“ä½œæ—¶å˜æ›´æ’ä»¶çŠ¶æ€
chrome.action.onClicked.addListener(async (tab) => {
    if (tab.url.startsWith(webstore)) {
        const prevState = await chrome.action.getBadgeText({ tabId: tab.id });
        const nextState = prevState === 'ON' ? 'OFF' : 'ON'
        await chrome.action.setBadgeText({
            tabId: tab.id,
            text: nextState,
        });
        // æ ¹æ®æ’ä»¶çŠ¶æ€å˜åŒ–åŠ¨æ€æ’å…¥å’Œåˆ é™¤ä¸“æ³¨æ¨¡å¼æ–‡ä»¶
        if (nextState === "ON") {
            await chrome.scripting.insertCSS({
              files: ["focus-mode.css"],
              target: { tabId: tab.id },
            });
        } else if (nextState === "OFF") {
            await chrome.scripting.removeCSS({
              files: ["focus-mode.css"],
              target: { tabId: tab.id },
            });
        }
    }
})
```

* ä¸“æ³¨æ¨¡å¼æ–‡ä»¶ï¼ˆå»é™¤é¡µé¢å¤šä½™å†…å®¹çš„CSSæ–‡ä»¶ï¼‰

```css
.sidebar {
  display: none;
}

.article-suspended-panel {
  display: none;
}

.main-area {
  width: 100% !important;
}
```

### è¡¥å……å¿…è¦é…ç½®

1. æ¿€æ´»æ’ä»¶ICONçš„Actionäº‹ä»¶

```json
{
  "action": {
    "default_icon": {
      "16": "./assets/icon-16.png",
      "32": "./assets/icon-32.png",
      "48": "./assets/icon-48.png",
      "128": "./assets/icon-128.png"
    }
  }
}
```

2. æ·»åŠ activeTabæƒé™ï¼ˆå•å‡»æ’ä»¶ICONåå¯ä»¥å¾—åˆ°Tabä¿¡æ¯ï¼‰

```json
{
   "permissions": ["activeTab"]
}
```

3. æ·»åŠ scriptingæƒé™ï¼ˆå¯ä»¥ä½¿ç”¨scripting API æ·»åŠ /åˆ é™¤ æ ·å¼è¡¨ï¼‰

```json
{
  "permissions": ["scripting"]
}
```

4. å¿«æ·é”®æ”¯æŒ

```json
{
  "commands": {
    "_execute_action": {
      "suggested_key": {
        "default": "Ctrl+B",
        "mac": "Command+B"
      }
    }
  }
}
```

### åœ¨æ‰©å±•ç¨‹åºä¸­åˆ·æ–°æ’ä»¶å¹¶æµ‹è¯•


## å®ç°é€‰é¡¹å¡çš„ç®¡ç†

é€šè¿‡å¼€å‘chrome expansionå®ç°åœ¨å¼¹çª—ä¸­æ•´åˆå·²æ‰“å¼€çš„æ˜é‡‘æ–‡ç« åˆ—è¡¨

### æ¡ˆä¾‹å…³é”®è¯

1. APIï¼šTabs API
2. ä¸»æœºæƒé™

### æœŸæœ›æ•ˆæœ

![](https://temp-files-20221205.oss-cn-hangzhou.aliyuncs.com/picgo/202304041517224.png)

### é…ç½®æ¸…å•æ–‡ä»¶

æ²¿ç”¨ä¸Šä¸€ä¸ªæ¡ˆä¾‹

### åˆ›å»ºå¼¹çª—

1. å…ˆé…ç½®

```json
{
  "action": {
    "default_popup": "./popups/popup.html"
  }
}
```

3. åç¼–å†™ï¼ˆç¼–å†™é¡µé¢ã€ç¼–å†™æ ·å¼ã€ç¼–å†™è„šæœ¬ï¼‰

* ç¼–å†™é¡µé¢

```html
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./popup.css" />
</head>

<body>
    <template id="li_template">
        <li>
            <a>
                <h3 class="title">Tab Title</h3>
                <p class="pathname">Tab Pathname</p>
            </a>
        </li>
    </template>

    <h1>å·²æ‰“å¼€çš„æ˜é‡‘æ–‡ç« </h1>
    <ul></ul>
    <script src="./popup.js" type="module"></script>
</body>

</html>
```

* ç¼–å†™æ ·å¼

```css
body {
  width: 20rem;
}

ul {
  list-style-type: none;
  padding-inline-start: 0;
  margin: 1rem 0;
}

li {
  padding: 0.25rem;
}
li:nth-child(odd) {
  background: #80808030;
}
li:nth-child(even) {
  background: #ffffff;
}

h3,
p {
  margin: 0;
}
```

* ç¼–å†™è„šæœ¬

```JavaScript
const tabs = await chrome.tabs.query({
    url: [
        "https://juejin.cn/post/*"
    ],
});

const template = document.getElementById("li_template");
const elements = new Set();
for (const tab of tabs) {
    const element = template.content.firstElementChild.cloneNode(true);

    const title = tab.title.split("-")[0].trim();
    const pathname = new URL(tab.url).pathname.slice("/post".length);

    element.querySelector(".title").textContent = title;
    element.querySelector(".pathname").textContent = pathname;
    element.querySelector("a").addEventListener("click", async () => {
        await chrome.tabs.update(tab.id, { active: true });
        await chrome.windows.update(tab.windowId, { focused: true });
    });

    elements.add(element);
}
document.querySelector("ul").append(...elements);
```

### æˆæƒç«™ç‚¹

æ—¢èƒ½å¾—åˆ°æ•°æ®ï¼Œåˆä¸æ‰©å¤§èŒƒå›´

```json
{
  "host_permissions": ["https://juejin.cn/*"]
}
```

### åœ¨æ‰©å±•ç¨‹åºä¸­åˆ·æ–°æ’ä»¶å¹¶æµ‹è¯•

## æ€»ç»“

Chromeæ‰©å±•å¼€å‘å…¥é—¨æŒ‡å—å°±å…ˆä»‹ç»è¿™ä¹ˆå¤šï¼Œè¿™ä¸‰ä¸ªæ¡ˆä¾‹åŒ…å«äº†Chromeæ‰©å±•å¼€å‘çš„å‡ ä¸ªé‡è¦æ¦‚å¿µï¼Œæ›´å¤šçš„Chromeæ‰©å±•å¼€å‘å­¦ä¹ å¯ä»¥é€šè¿‡é˜…è¯»[å®˜æ–¹æ–‡æ¡£](https://developer.chrome.com/docs/extensions/mv3/getstarted/)ï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬è¿™ä¸‰ä¸ªæ¡ˆä¾‹ï¼Œå¥½äº†åŠ¨æ‰‹æ“ä½œä¸€ä¸‹å§ã€‚

PSï¼šå®Œæ•´ä»£ç è§[1024Code](https://1024code.com/codecubes/kwAhOat)ï¼›

<Comment />
